// 1. NOVELAS DESDE EL C√ìDIGO (EDITA ESTE ARRAY PARA AGREGAR NOVELAS)
const novelasData = [
    // Puedes agregar m√°s novelas aqu√≠
    {
        title: "Quickly Wear the Face of the Devil",
        altTitle: "Âø´Á©ø‰πãÊâìËÑ∏ÁãÇÈ≠î",
        genre: "Action, Adult, Adventure, Comedy, Drama, Fantasy, Romance, School Life, Sci-fi, Yaoi",
        tags: "Acting,  Adapted to Drama CD,  Age Progression,  Alternate World,  Ancient China,  Arranged Marriage,  Arrogant Characters,  Artificial Intelligence,  Artists,  Autism,  Beasts,  Calm Protagonist , Celebrities,  Charismatic Protagonist,  Charming Protagonist,  Clever Protagonist,  Confident Protagonist,  Cunning Protagonist,  Death of Loved Ones, Devoted Love Interests, Disabilities , Doting Love Interests, Eidetic Memory, Episodic, Famous Protagonist, First Love, First-time Interc**rse,  F*llatio, Genius Protagonist, God-human Relationship Gods, Guardian Relationship , Hackers, Handsome Male Lead, Human-Nonhuman Relationship, Jack of All Trades,  Livestreaming, Love Interest Falls in Love First, Male Yandere, Masochistic Characters, Master-Disciple Relationship, Models, Modern Day, Multiple Realms, Obsessive Love, Older Love Interests, Omegaverse, Outer Space, Overpowered Protagonist, Possessive Characters, Post-apocalyptic, Power Couple, Priests, Protagonist Strong from the Start, R-18, Revenge, Royalty, R*pe, Schemes And Conspiracies, Scientists, Shota, Showbiz, Soul Power, Strong Love Interests, System Administrator, Transmigration, Virtual Reality, World Hopping, Zombies",
        author: "Casanovanic Bookworm, Feng Liu Shu Dai, È¢®ÊµÅÊõ∏ÂëÜ, È£éÊµÅ‰π¶ÂëÜ",
        description: "Un hacker de alto nivel fue elegido por el Se√±or Dios para renacer en innumerables mundos, siempre como un villano prescindible.Sin libre albedr√≠o, cada mundo se convirti√≥ en un callej√≥n sin salida. Cada una de sus vidas termin√≥ tr√°gicamente.Finalmente, despu√©s de luchar por el control del sistema de villanos, este hacker experto decidi√≥ vengarse. Incluso si sus huesos estuvieran podridos, elegir√≠a ocupar las alturas de la moralidad, aunque solo fuera en la superficie.As√≠, cambiar√≠a su destino como una escoria ab*sada.",
        link: "https://www.bing.com/ck/a?!&&p=d12a6a79be0dae09b2907cddc194f5e2c6693b08110fae1c8d25aa493afe06e8JmltdHM9MTc0NjE0NDAwMA&ptn=3&ver=2&hsh=4&fclid=1a91c2f1-7014-60b9-0bc1-d73a713561e6&psq=quickly+wear+the+face+of+the+devil&u=a1aHR0cHM6Ly9rZXp0cmFuc2xhdGlvbnMuY29tL3F1aWNrbHktd2Vhci10aGUtZmFjZS1vZi10aGUtZGV2aWwv&ntb=1",
        status: "Finalizado",
        chapters: 268,
        rating: 10,
        image: "https://cdn.novelupdates.com/images/2021/12/Quickly-Wear-the-Face-of-the-Devil_1640588524.jpg",
        pdf: "",
        isFavorite: true,
        audience: "adult",
    },
    {
        title: "The Little Kitten is Saving the Villain Again Today!",
        altTitle: "Áå´Áå´‰ªäÂ§©‰πüÂú®ÊãØÊïëÂèçÊ¥æ[Âø´Á©ø]",
        genre: "Fantasy, Romance, Shounen Ai, Yaoi",
        tags: "Autism, Black Belly, Cute Protagonist, Devoted Love Interests, Doting Love Interests, Ghosts, Handsome Male   Lead, Male Yandere, Naive Protagonist, Non-humanoid Protagonist, Obsessive Love, Possessive Characters, Transmigration, Vampires, World Hopping, World Travel Zombies",
        author: "ÂïÑÁ±≥",
        description: "Tang Xi es un peque√±o gatito, un regordete y adorable brit√°nico de pelo corto dorado. Dado que a los esp√≠ritus no se les permit√≠a manifestarse despu√©s de la fundaci√≥n de la naci√≥n, trabaj√≥ duro para disfrazarse de cachorro, descarg√°ndose de los humanos todos los d√≠as. Hasta que un d√≠a, fue atrapado por un sistema y enviado a innumerables mundos para completar tareas. Sistema: ¬øCu√°l es nuestro lema? Tang Xi: ¬°Pescado seco! ¬°Pescado seco! ¬°Pescado seco! El sistema odia el hierro por no convertirse en acero: ¬°est√° salvando al villano!\n\n‚Ä¶..\n\nTang Xi, agarrando un pescado seco, tropez√≥ accidentalmente con el villano en medio de cometer un crimen. Sobresaltado, inmediatamente volvi√≥ a su forma de gatito.\n\nLa expresi√≥n del villano era ilegible mientras recog√≠a al peque√±o gatito esponjoso del suelo: \"¬øHmm?\"\n\nTang Xi: ¬°Sistema, ayuda! ¬°Estoy a punto de ser comido! QwQ\n\nSistema: Despedida. üòä\n\nEl villano pellizc√≥ suavemente las suaves patas del gatito, levantando una ceja con visible inter√©s.\n\nTang Xi: ... Maullar.\n\n(Haci√©ndose el lindo a survive.jpg)\n\nUn seme posesivo y ligeramente desquiciado √ó Un gatito uke ingenuo al que se puede atraer con comida\n\nPD: El uke es pegajoso y mimado alrededor del seme, pero tiene un aura de rompecorazones para los dem√°s (¬øporque a qui√©n no le gustan los gatos?). Es un gatito inocente.\n\nEl seme solo ha tenido el uke de principio a fin, f√≠sica y emocionalmente.",
        link: "",
        status: "Completo",
        chapters: 100,
        rating: 7,
        image: "https://cdn.novelupdates.com/images/2025/04/The-Little-Kitten-is-Saving-the-Villain-Again-Today.jpeg",
        pdf: "",
        isFavorite: true,
        audience: "general",
    },
    {
        title: "After Resigning, I Became Popular all over the Universe [Quick Transmigration]",
        altTitle: "ËæûËÅåÂêéÊàëÁàÜÁ∫¢ÂÖ®ÂÆáÂÆô[Âø´Á©ø]",
        genre: "Action, Adventure, Romance, Shounen Ai, Supernatural",
        tags: "Ancient China, Appearance Different from Actual Age, Aristocracy, Arrogant Characters, Business Management, Calm Protagonist, Caring Protagonist, Charismatic Protagonist, Charming Protagonist, Clever Protagonist, Clingy Lover, Clumsy Love Interests, Confident Protagonist, Devoted Love Interests, Doting Love Interests, Dragons, Fantasy World, First Love, Futuristic Setting, Gods, Hackers, Handsome Male Lead Love, Interest Falls in Love First, Magical Space, Modern Day, Nationalism, Older Love Interests, Power Couple, Protagonist Strong from the Start, Revenge, Secret Crush, Showbiz, Slow Romance, Strong Love Interests, Transmigration, Wealthy Characters, World Hopping, World Tree, Zombies",
        author: "ËÆ∏ÂºÄ,Xu Kai",
        description: "El beb√© drag√≥n de la familia del Se√±or Dios fue despedido y reempleado, y alcanz√≥ la cima de su vida con un gui√≥n de carne de ca√±√≥n en la mano.\n\n‚Äî‚Äî\n\n(1) Estudiantes extranjeros que fueron acusados falsamente de traici√≥n ‚Üí regresaron a la patria para usar la tecnolog√≠a para convertirnos en los m√°s fuertes del mundo\n\n(2) Personas con habilidades prof√©ticas que fueron explotadas hasta la muerte ‚Üí Coopere con el pa√≠s para responder a los desastres con anticipaci√≥n, y China se convertir√° en una tierra pura global despu√©s del apocalipsis\n\n(3) El alma de un joven rico se intercambia por un ni√±o pobre ‚Üí Abandonado por una familia adinerada, el verdadero joven maestro us√≥ sus habilidades para iniciar un negocio m√°s grande y sus padres biol√≥gicos se arrepintieron demasiado tarde\n\n. (4) El Omega amante del dinero que quer√≠a casarse con una familia adinerada ‚Üí El chico d√©bil y lindo expuso su identidad Alfa en p√∫blico y destruy√≥ a un s√∫per Zerg de un solo golpe\n\n(5) Un chico nuevo en la industria del entretenimiento que dice palabras salvajes y est√° rodeado de fan√°ticos negros ‚Üí Como monje de cinco mil a√±os, soy el dios del ajedrez antiguo, la pintura, la poes√≠a y los inmortales. No estoy loco si digo palabras tan arrogantes.\n\n(6) Un joven maestro del continente Xuanwu al que le gustan las joyas y el maquillaje hermoso ‚Üí El c√≠rculo m√°gico grabado en mi gema puede derribarte la cabeza con solo un lanzamiento.\n\n(7) El general deca√≠do con las piernas incapacitadas ‚Üí Estudi√≥ farmacia y resucit√≥, y la gloria del h√©roe que se convirti√≥ en el salvador se volvi√≥ cada vez m√°s deslumbrante...",
        link: "https://www.fanmtl.com/novel/shu248255.html",
        status: "Finalizado",
        chapters: 293,
        rating: 10,
        image: "https://cdn.novelupdates.com/images/2024/05/After-Resigning-I-Became-Popular-all-over-the-Universe-Quick-Transmigration.jpg",
        pdf: "",
        isFavorite: false,
        audience: "general",
    },
];

document.addEventListener("DOMContentLoaded", () => {
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabContents = document.querySelectorAll(".tab-content");
    const addNovelForm = document.getElementById("addNovelForm");
    const catalogList = document.getElementById("catalogoList");
    const favoritesList = document.getElementById("favoritesList");

    // Alternar entre pesta√±as
    tabButtons.forEach((button) => {
        button.addEventListener("click", () => {
            tabButtons.forEach((btn) => btn.classList.remove("active"));
            tabContents.forEach((content) => content.classList.remove("active"));

            button.classList.add("active");
            const tabId = button.getAttribute("data-tab");
            document.getElementById(tabId).classList.add("active");
        });
    });

    // Guardar novelas en localStorage
    const saveNovelsToLocalStorage = (novels) => {
        localStorage.setItem("novels", JSON.stringify(novels));
    };

    // Cambia la funci√≥n loadNovelsFromLocalStorage para que tambi√©n muestre las novelas agregadas en esta sesi√≥n
    const loadNovelsFromLocalStorage = () => {
        catalogList.innerHTML = ""; // Limpiar el cat√°logo antes de mostrar
        const novels = JSON.parse(localStorage.getItem("novels")) || [];
        // Mostrar novelas de localStorage
        novels.forEach((novel) => addNovelToCatalog(novel));
        // Mostrar novelas de novelasData que NO est√©n ya en localStorage (por t√≠tulo)
        novelasData.forEach((novel) => {
            if (!novels.some(n => n.title === novel.title)) {
                addNovelToCatalog(novel);
            }
        });
    };

    // Agregar novela al cat√°logo
    const addNovelToCatalog = (novel) => {
        const li = document.createElement("li");
        li.classList.add("catalog-item");
        li.innerHTML = `
            <div class="card">
                <div class="card-front">
                    <img src="${novel.image}" alt="${novel.title}">
                </div>
                <div class="card-back">
                    <h3>${novel.title}</h3>
                    <p>${novel.altTitle}</p>
                    <p>${novel.genre}</p>
                    <p>${novel.tags}</p>
                    <p>${novel.description}</p>
                    <p>${novel.chapters} cap√≠tulos</p>
                    <p>Calificaci√≥n: ${novel.rating}/10</p>
                    <p>${novel.audience === "adult" ? "üîû Para adultos" : "Apto para todo p√∫blico"}</p>
                    <a href="${novel.link}" target="_blank" class="cta-button">Leer Novela</a>
                    ${novel.pdf ? `<a href="${novel.pdf}" target="_blank" class="cta-button">Ver PDF</a>` : ""}
                    <button class="favorite-button${novel.isFavorite ? ' selected' : ''}" ${!isLoggedIn() ? 'disabled' : ''}>
                        <i class="fa-solid fa-heart"></i> Favorito
                    </button>
                </div>
            </div>
        `;

        // Bot√≥n de favorito
        const favBtn = li.querySelector(".favorite-button");
        if (novel.isFavorite) {
            favBtn.classList.add("selected");
        }
        favBtn.addEventListener("click", () => {
            if (!isLoggedIn()) {
                alert("Debes crear una cuenta para usar favoritos.");
                return;
            }
            novel.isFavorite = !novel.isFavorite;
            favBtn.classList.toggle("selected", novel.isFavorite);
            // Actualizar en localStorage
            const novels = getAllNovels().map(n => n.title === novel.title ? {...n, isFavorite: novel.isFavorite} : n);
            saveNovelsToLocalStorage(novels);
            updateFavoritesList();
        });

        catalogList.prepend(li); // Agregar la novela al inicio del cat√°logo
    };

    // Actualizar la lista de favoritos
    const updateFavoritesList = () => {
        favoritesList.innerHTML = ""; // Limpiar la lista de favoritos
        const novels = getAllNovels().filter((novel) => novel.isFavorite);
        novels.forEach((novel) => {
            const li = document.createElement("li");
            li.classList.add("catalog-item");
            li.innerHTML = `
                <div class="card">
                    <div class="card-front">
                        <img src="${novel.image}" alt="${novel.title}">
                    </div>
                    <div class="card-back">
                        <h3>${novel.title}</h3>
                        <p>${novel.altTitle}</p>
                        <p>${novel.genre}</p>
                        <p>${novel.tags}</p>
                        <p>${novel.description}</p>
                        <p>${novel.chapters} cap√≠tulos</p>
                        <p>Calificaci√≥n: ${novel.rating}/10</p>
                        <p>${novel.adult ? "üîû Para adultos" : "Apto para todo p√∫blico"}</p>
                        <a href="${novel.link}" target="_blank" class="cta-button">Leer Novela</a>
                    </div>
                </div>
            `;
            favoritesList.prepend(li);
        });
    };

    // Obtener todas las novelas
    const getAllNovels = () => JSON.parse(localStorage.getItem("novels")) || [];

    // Manejar el env√≠o del formulario
    addNovelForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const imageInput = document.getElementById("imageFile");
        const pdfInput = document.getElementById("pdfFile");
        const imageFile = imageInput.files[0];
        const pdfFile = pdfInput.files[0];
        let imageSrc = "";
        let pdfSrc = "";

        if (imageFile) {
            const reader = new FileReader();
            reader.onload = () => {
                imageSrc = reader.result;

                if (pdfFile) {
                    const pdfReader = new FileReader();
                    pdfReader.onload = () => {
                        pdfSrc = pdfReader.result;

                        const novel = createNovelObject(imageSrc, pdfSrc);
                        saveAndDisplayNovel(novel);
                    };
                    pdfReader.readAsDataURL(pdfFile);
                } else {
                    const novel = createNovelObject(imageSrc, null);
                    saveAndDisplayNovel(novel);
                }
            };
            reader.readAsDataURL(imageFile);
        } else {
            alert("Por favor, selecciona una imagen.");
        }
    });

    // Crear objeto de novela
    const createNovelObject = (imageSrc, pdfSrc) => ({
        title: document.getElementById("title").value,
        altTitle: document.getElementById("altTitle").value,
        genre: document.getElementById("genre").value,
        tags: document.getElementById("tags").value,
        description: document.getElementById("description").value,
        link: document.getElementById("link").value,
        status: document.getElementById("status").value,
        chapters: document.getElementById("chapters").value,
        rating: document.getElementById("rating").value,
        image: imageSrc,
        pdf: pdfSrc,
        isFavorite: false,
        audience: document.getElementById("audience").value // Nuevo campo para el p√∫blico
    });

    // Guardar y mostrar novela
    const saveAndDisplayNovel = (novel) => {
        const novels = getAllNovels();
        novels.unshift(novel); // Agregar la novela al inicio de la lista
        saveNovelsToLocalStorage(novels);
        loadNovelsFromLocalStorage(); // <-- Esto asegura que se muestre en el cat√°logo
        addNovelForm.reset();
        document.querySelector(".tab-button[data-tab='catalogSection']").click();
    };

    // Exportar novelas a un archivo JSON
    const exportNovels = () => {
        const novels = getAllNovels();
        const blob = new Blob([JSON.stringify(novels, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "novelas.json";
        a.click();
        URL.revokeObjectURL(url);
    };

    // Importar novelas desde un archivo JSON
    const importNovels = (file) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const novels = JSON.parse(e.target.result);
                if (Array.isArray(novels)) {
                    const existingNovels = getAllNovels();
                    const mergedNovels = [...existingNovels, ...novels];
                    saveNovelsToLocalStorage(mergedNovels);
                    catalogList.innerHTML = ""; // Limpiar el cat√°logo
                    loadNovelsFromLocalStorage(); // Recargar las novelas
                } else {
                    alert("El archivo no contiene un formato v√°lido.");
                }
            } catch (error) {
                alert("Error al importar el archivo. Aseg√∫rate de que sea un archivo JSON v√°lido.");
            }
        };
        reader.readAsText(file);
    };

    // Agregar eventos para exportar e importar
    document.getElementById("exportButton").addEventListener("click", exportNovels);
    document.getElementById("importFile").addEventListener("change", (e) => {
        importNovels(e.target.files[0]);
    });

    // Sobrescribe localStorage solo si est√° vac√≠o (primera vez)
    if (!localStorage.getItem("novels")) {
        localStorage.setItem("novels", JSON.stringify(novelasData));
    }

    loadNovelsFromLocalStorage();
    updateFavoritesList();

    // Si el cat√°logo est√° vac√≠o, cargar novelasData y guardarlas
    if (catalogList.children.length === 0) {
        saveNovelsToLocalStorage(novelasData);
        loadNovelsFromLocalStorage();
    }

    // --- BUSCADOR Y FILTROS ---
    const searchForm = document.getElementById("searchForm");
    const searchTitle = document.getElementById("searchTitle");
    const searchGenre = document.getElementById("searchGenre");
    const searchTags = document.getElementById("searchTags");
    const searchAuthor = document.getElementById("searchAuthor");
    const clearSearch = document.getElementById("clearSearch");
    const searchResults = document.getElementById("searchResults");

    // Funci√≥n para filtrar novelas por palabras completas
    function filterNovels() {
        const titleValue = searchTitle.value.trim().toLowerCase();
        const genreValue = searchGenre.value.trim().toLowerCase();
        const tagsValue = searchTags.value.trim().toLowerCase();
        const authorValue = searchAuthor.value.trim().toLowerCase();

        const novels = getAllNovels();
        const filtered = novels.filter(novel => {
            const matchTitle = titleValue ? matchWords(novel.title?.toLowerCase(), titleValue) : true;
            const matchGenre = genreValue ? matchWords(novel.genre?.toLowerCase(), genreValue) : true;
            const matchTags = tagsValue ? matchWords(novel.tags?.toLowerCase(), tagsValue) : true;
            const matchAuthor = authorValue ? matchWords(novel.author?.toLowerCase(), authorValue) : true;
            return matchTitle && matchGenre && matchTags && matchAuthor;
        });

        searchResults.innerHTML = ""; // Limpiar resultados previos
        filtered.forEach(addNovelToSearchResults);
    }

    // Funci√≥n para verificar coincidencias de palabras completas
    function matchWords(text, searchValue) {
        if (!text || !searchValue) return false;
        const words = text.split(/\s+/); // Dividir el texto en palabras
        const searchWords = searchValue.split(/\s+/); // Dividir el valor de b√∫squeda en palabras
        return searchWords.every(word => words.some(w => w.startsWith(word))); // Verificar si las palabras comienzan con el valor de b√∫squeda
    }

    // Agregar novela a los resultados de b√∫squeda
    const addNovelToSearchResults = (novel) => {
        const li = document.createElement("li");
        li.classList.add("catalog-item");
        li.innerHTML = `
            <div class="card">
                <div class="card-front">
                    <img src="${novel.image}" alt="${novel.title}">
                </div>
                <div class="card-back">
                    <h3>${novel.title}</h3>
                    <p>${novel.altTitle}</p>
                    <p>${novel.genre}</p>
                    <p>${novel.tags}</p>
                    <p>${novel.description}</p>
                    <p>${novel.chapters} cap√≠tulos</p>
                    <p>Calificaci√≥n: ${novel.rating}/10</p>
                    <p>${novel.adult ? "üîû Para adultos" : "Apto para todo p√∫blico"}</p>
                    <a href="${novel.link}" target="_blank" class="cta-button">Leer Novela</a>
                </div>
            </div>
        `;
        searchResults.appendChild(li);
    };

    // Manejar el env√≠o del formulario de b√∫squeda
    searchForm.addEventListener("submit", (e) => {
        e.preventDefault();
        filterNovels();
    });

    // Limpiar b√∫squeda
    clearSearch.addEventListener("click", () => {
        searchTitle.value = "";
        searchGenre.value = "";
        searchTags.value = "";
        searchAuthor.value = "";
        searchResults.innerHTML = ""; // Limpiar resultados
    });

    // --- GESTI√ìN DE CUENTA DE USUARIO ---
    const userButton = document.getElementById("userButton");
    const userModal = document.getElementById("userModal");
    const closeUserModal = document.getElementById("closeUserModal");
    const userForm = document.getElementById("userForm");
    const usernameInput = document.getElementById("username");
    const passwordInput = document.getElementById("userpassword");
    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");
    const deleteAccountBtn = document.getElementById("deleteAccount");
    const addNovelSection = document.getElementById("addNovelSection");
    const addNovelTab = document.querySelector(".tab-button[data-tab='addNovelSection']");

    // Cuenta maestra (puedes cambiar el usuario y contrase√±a aqu√≠)
    const MASTER_USER = "admin";
    const MASTER_PASS = "admin123";

    // Guardar usuarios registrados (array de objetos {username, password})
    function getRegisteredUsers() {
        return JSON.parse(localStorage.getItem("novelasUsersList") || "[]");
    }
    function saveRegisteredUsers(users) {
        localStorage.setItem("novelasUsersList", JSON.stringify(users));
    }

    function isLoggedIn() {
        return !!localStorage.getItem("novelasUser");
    }
    function getCurrentUser() {
        return localStorage.getItem("novelasUser");
    }
    function setUser(username) {
        localStorage.setItem("novelasUser", username);
    }
    function removeUser() {
        localStorage.removeItem("novelasUser");
        localStorage.removeItem("novelasUserPassword");
        // Limpiar favoritos al borrar cuenta
        const novels = getAllNovels().map(n => ({ ...n, isFavorite: false }));
        saveNovelsToLocalStorage(novels);
        loadNovelsFromLocalStorage();
        updateFavoritesList();
    }

    // Mostrar modal de usuario
    userButton.addEventListener("click", () => {
        userModal.style.display = "flex";
        usernameInput.value = getCurrentUser() || "";
        passwordInput.value = "";
    });

    // Cerrar modal
    closeUserModal.addEventListener("click", () => {
        userModal.style.display = "none";
    });

    // Registrar cuenta
    registerBtn.addEventListener("click", () => {
        const username = usernameInput.value.trim();
        const password = passwordInput.value;
        if (!username || !password) {
            alert("Debes ingresar usuario y contrase√±a.");
            return;
        }
        let users = getRegisteredUsers();
        if (username === MASTER_USER) {
            alert("No puedes registrar el usuario maestro.");
            return;
        }
        if (users.find(u => u.username === username)) {
            alert("Ese usuario ya existe.");
            return;
        }
        users.push({ username, password });
        saveRegisteredUsers(users);
        setUser(username);
        localStorage.setItem("novelasUserPassword", password);
        alert("Cuenta creada e iniciada sesi√≥n correctamente.");
        userModal.style.display = "none";
        updateUIForUser();
    });

    // Iniciar sesi√≥n
    loginBtn.addEventListener("click", () => {
        const username = usernameInput.value.trim();
        const password = passwordInput.value;
        if (!username || !password) {
            alert("Debes ingresar usuario y contrase√±a.");
            return;
        }
        // Maestra
        if (username === MASTER_USER && password === MASTER_PASS) {
            setUser(MASTER_USER);
            localStorage.setItem("novelasUserPassword", MASTER_PASS);
            alert("Sesi√≥n iniciada como cuenta maestra.");
            userModal.style.display = "none";
            updateUIForUser();
            return;
        }
        let users = getRegisteredUsers();
        const user = users.find(u => u.username === username);
        if (!user) {
            alert("Usuario no encontrado.");
            return;
        }
        if (user.password !== password) {
            alert("Contrase√±a incorrecta.");
            return;
        }
        setUser(username);
        localStorage.setItem("novelasUserPassword", password);
        alert("Sesi√≥n iniciada correctamente.");
        userModal.style.display = "none";
        updateUIForUser();
    });

    // Borrar cuenta
    deleteAccountBtn.addEventListener("click", () => {
        if (getCurrentUser() === MASTER_USER) {
            alert("No puedes borrar la cuenta maestra.");
            return;
        }
        if (confirm("¬øEst√°s seguro de que deseas borrar tu cuenta? Esta acci√≥n no se puede deshacer.")) {
            let users = getRegisteredUsers();
            users = users.filter(u => u.username !== getCurrentUser());
            saveRegisteredUsers(users);
            removeUser();
            alert("Cuenta borrada.");
            updateUIForUser();
        }
    });

    // Mostrar/ocultar secci√≥n de agregar novela solo para cuenta maestra
    function updateUIForUser() {
        if (isLoggedIn()) {
            userButton.innerHTML = `<i class="fa-solid fa-user"></i> ${getCurrentUser()}`;
            document.querySelectorAll(".favorite-button").forEach(btn => btn.disabled = false);
            // Mostrar secci√≥n solo si es admin
            if (getCurrentUser() === MASTER_USER) {
                addNovelSection.style.display = "block";
                if (addNovelTab) addNovelTab.style.display = "inline-block";
            } else {
                addNovelSection.style.display = "none";
                if (addNovelTab) addNovelTab.style.display = "none";
            }
        } else {
            userButton.innerHTML = `<i class="fa-solid fa-user"></i>`;
            document.querySelectorAll(".favorite-button").forEach(btn => btn.disabled = true);
            addNovelSection.style.display = "none";
            if (addNovelTab) addNovelTab.style.display = "none";
        }
    }

    // Al cargar la p√°gina, actualizar UI seg√∫n usuario
    updateUIForUser();

    // Manejar comentarios generales
    const generalCommentForm = document.getElementById("generalCommentForm");
    const generalCommentText = document.getElementById("generalCommentText");
    const generalCommentsList = document.getElementById("generalCommentsList");

    // Guardar comentarios generales en localStorage
    const saveGeneralComments = (comments) => {
        localStorage.setItem("generalComments", JSON.stringify(comments));
    };

    // Obtener comentarios generales de localStorage
    const getGeneralComments = () => {
        return JSON.parse(localStorage.getItem("generalComments")) || [];
    };

    // Mostrar comentarios generales
    const displayGeneralComments = () => {
        generalCommentsList.innerHTML = ""; // Limpiar comentarios previos
        const comments = getGeneralComments();
        comments.forEach((comment, index) => {
            const li = document.createElement("li");
            li.textContent = comment;
            const deleteButton = document.createElement("button");
            deleteButton.textContent = "Eliminar";
            deleteButton.classList.add("delete-comment-button");
            deleteButton.addEventListener("click", () => {
                comments.splice(index, 1);
                saveGeneralComments(comments);
                displayGeneralComments();
            });
            li.appendChild(deleteButton);
            generalCommentsList.appendChild(li);
        });
    };

    // Manejar env√≠o de comentarios generales
    generalCommentForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const comment = generalCommentText.value.trim();
        if (comment) {
            const comments = getGeneralComments();
            comments.push(comment);
            saveGeneralComments(comments);
            generalCommentText.value = ""; // Limpiar campo de texto
            displayGeneralComments();
        } else {
            alert("El comentario no puede estar vac√≠o.");
        }
    });

    // Mostrar comentarios generales al cargar la p√°gina
    displayGeneralComments();
});